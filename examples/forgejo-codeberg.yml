name: Claude for Codeberg

# Example configuration for using Claude with Codeberg (codeberg.org)
# Codeberg is a public Forgejo instance that hosts open-source projects

on:
  issue_comment:
    types: [created]
  issues:
    types: [opened, assigned]
  pull_request_review:
    types: [submitted]
  pull_request_review_comment:
    types: [created]

jobs:
  claude-response:
    runs-on: ubuntu-latest

    # Only respond to @claude mentions
    if: >
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && github.event.action == 'assigned' && github.event.assignee.login == 'claude-bot') ||
      (github.event_name == 'issues' && github.event.action == 'opened' && contains(github.event.issue.body, '@claude')) ||
      (github.event_name == 'pull_request_review' && contains(github.event.review.body, '@claude')) ||
      (github.event_name == 'pull_request_review_comment' && contains(github.event.comment.body, '@claude'))

    steps:
      - name: Claude Code Response
        uses: anthropics/claude-code-action@v1
        with:
          # Codeberg configuration (public Forgejo instance)
          forge_type: forgejo
          forge_api_url: https://codeberg.org/api/v1
          forge_server_url: https://codeberg.org

          # Trigger configuration
          trigger_phrase: "@claude"
          assignee_trigger: "claude-bot"

          # Repository configuration
          base_branch: main
          branch_prefix: "claude/"

          # Conversation settings
          max_turns: 3
          timeout_minutes: 20

          # Custom instructions for open-source projects
          custom_instructions: |
            You are helping with an open-source project hosted on Codeberg.
            Please follow these guidelines:
            - Be respectful and helpful to the community
            - Follow the project's contributing guidelines
            - Consider the open-source nature of the project in your suggestions
            - Help maintain code quality and documentation
            - Be mindful of licensing implications

        env:
          # Anthropic API for Claude
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}

          # Codeberg token (generate from https://codeberg.org/user/settings/applications)
          GITHUB_TOKEN: ${{ secrets.CODEBERG_TOKEN }}
# Note: To use this with your Codeberg repository:
# 1. Generate a personal access token at https://codeberg.org/user/settings/applications
# 2. Add it as a secret named CODEBERG_TOKEN in your repository settings
# 3. Make sure your repository has Actions enabled
# 4. Update the trigger conditions as needed for your project
